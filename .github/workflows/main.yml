name: Daily Crawler
on:
  schedule:
    - cron: '0 */12 * * *' # 每 12 小時執行一次
  workflow_dispatch:  # 這一行是開啟手動執行按鈕的關鍵
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run crawler
        run: python main.py
      # 插入此步驟，300 秒等於 5 分鐘
      - name: 等待 5 分鐘
        run: sleep 300

      - name: 寄送 Email 通知
        uses: dawidd6/action-send-mail@v3
        with:
          # SMTP 伺服器設定 (以 Gmail 為例)
          server_address: smtp.gmail.com
          server_port: 465
          # 登入資訊 (從 Secrets 讀取)
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          # 郵件內容設定
          subject: "爬蟲結果報告 - ${{ github.run_id }}"
          to: "tonykuo@nfu.edu.tw"  # 接收結果的信箱
          from: "GitHub Scraper <your-email@gmail.com>"
          body: "你好，附件為最新的爬蟲數據結果。"
          # 夾帶檔案
          attachments: "data.csv"  # 填入你的 CSV 檔名
